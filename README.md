[![Supported python versions](https://img.shields.io/badge/Python-3.8%20%7C%203.9-blue?style=flat-square&logo=python)](https://www.python.org/)
[![Aiogram](https://img.shields.io/badge/Aiogram-blue?style=flat-square)](https://github.com/aiogram/aiogram/)
[![Yandex.Cloud](https://img.shields.io/badge/Yandex.Cloud-functions-9cf?style=flat-square&logo=data:image/png;base64,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)](https://cloud.yandex.ru/)

# aio-serverless-bot
Цель создания этого бота -- получить быстрый доступ к расписанию пригородного транспорта, используя популярный мессенджер Telegram.
Бот создан при помощи python, библиотеки [aiogram ver. 3.0.0.4b](https://docs.aiogram.dev/) и [API Яндекс.Расписаний](https://yandex.ru/dev/rasp/raspapi/)

## Функционал
* отображает маршруты и время прибытия транспорта на заданной остановке, используя API Яндекс.Расписаний
* находит маршрут, через несколько указанных остановок

## Запуск
Для запуска бота нужно иметь аккаунт нужно иметь аккаунт [Yandex.Cloud](https://cloud.yandex.ru/), получить токен бота у [BotFather](http://t.me/BotFather), получить API ключ от сервиса Яндекс.Расписания.

1. Создайте в Yandex Cloud **YDB** и в ней таблицу **`db-for-bot`**, содержащую колонки `user_id`, `last_codes`, `num`, `region`, `state`, `time_zone`, `transort_type`.
2. Создайте  **Yandex Cloud Function** в Yandex Cloud:
   - выберите язык программирования **Python*
   - загрузите файлы из репозитория в **Yandex Cloud Function** Editor
   - выберите точкой входа `main.handler`
   - добавьте переменную `BOT_TOKEN`, введите значения токена, полученное от BotFather
   -  то же самое проделайте с перемнной `YANDEX_API_KEY` и введите значение, полученное от API Яндекс.Расписаний
   -  скопируйте эндпоинт и размещение базы данных и создайте для этих двух значений соотвественно переменные `YDB_ENDPOINT` и `YDB_DATABASE`
   - создайте функцию `Create function`

3. Активируйте публичный доступ к  **Yandex Cloud Function**:
   - проверьте галочку `Public function`
   - скопируйте ссылку  `PUBLIC_FUNCTION_URL` 

4. Настройте получение сообщений ботом:
   - вставьте `TOKEN` и `PUBLIC_FUNCTION_URL` в шаблон ниже
   - шаблон: `https://api.telegram.org/botTOKEN/setWebhook?url=PUBLIC_FUNCTION_URL`
   - отправьте этот запрос в браузере и вы должны увидеть:  
     `{"ok": true,"result": true,"description": "Webhook was set"}`

5. Все должен работать
